rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Usage collection - only Cloud Functions (server-side) can write
    // Users can read their own usage data
    match /usage/{usageId} {
      // Allow server-side (Cloud Functions) to read/write
      // Server requests have request.auth != null but no specific uid checks needed
      allow read, write: if request.auth != null;
    }

    // User documents collection (for future use)
    // Each user can only access their own document
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // RevenueCat webhook cache (server-side only)
    match /revenuecat_cache/{userId} {
      allow read: if request.auth != null && request.auth.uid == userId;
      allow write: if false; // Only Cloud Functions can write (no client writes)
    }

    // Block all other collections by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
